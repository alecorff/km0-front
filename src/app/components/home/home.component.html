<ng-container *ngIf="!isLoading">

    <!-- PLAN D'ENTRAINEMENT ACTUEL -->
    <div class="current-prepa-card">
        <div *ngIf="currentPlan; else noCurrentTraining" (click)="goToCurrentPlan()">
            <div class="prepa-header">
                <span class="prepa-title">{{ 'i18n.page.home.training.plan' | translate }}: {{ currentPlan.name
                    }}</span>
                <span class="prepa-date">{{ 'i18n.page.home.training.date' | translate }}: {{ currentPlan.endDate |
                    date:'longDate' }}</span>
            </div>

            <!-- Prochaine séance -->
            <div class="next-session">
                <mat-icon>directions_run</mat-icon>
                <span>{{ 'i18n.page.home.training.nextSession' | translate }}: {{ nextSession.day }} - {{
                    nextSession.name }}</span>
            </div>

            <!-- Avancement des semaines -->
            <div class="weeks-progress">
                <div *ngFor="let w of weeksArray; index as i" class="week-block"
                    [class.week-done]="i < currentPlan.weeksDone">
                </div>
            </div>
            <div class="weeks-label">
                {{ currentPlan.weeksDone }} / {{ currentPlan.totalWeeks }} {{ 'i18n.page.home.training.weeksCompleted'
                | translate }}
            </div>
        </div>

        <!-- CREER UN PLAN D'ENTRAINEMENT -->
        <ng-template #noCurrentTraining>
            <div class="empty-state">
                <div class="empty-icon">
                    <img [src]="'assets/images/add-circle-icon-200.svg'" />
                </div>

                <div class="empty-title">
                    {{ 'i18n.page.home.noTraining.title' | translate }}
                </div>

                <div class="empty-subtitle">
                    {{ 'i18n.page.home.noTraining.subtitle' | translate }}
                </div>

                <button mat-raised-button class="empty-action" (click)="createPlan()">
                    {{ 'i18n.page.home.noTraining.action' | translate }}
                </button>
            </div>
        </ng-template>
    </div>

    <!-- ANCIENS PLANS D'ENTRAINEMENT -->
    <!-- Message par défaut si pas encore de plans -->
    <div *ngIf="pastPrepas.length === 0; else carouselBlock" class="no-past-prepas">
        <img class="no-icon" [src]="'assets/images/history-icon-200.svg'" />
        <div class="no-title">{{ 'i18n.page.home.noCarousel.title' | translate }}</div>
        <div class="no-subtitle">{{ 'i18n.page.home.noCarousel.subtitle' | translate }}</div>
    </div>

    <!-- Carousel -->
    <ng-template #carouselBlock>
        <div class="past-prepas-section">
            <h2 class="section-title">{{ 'i18n.page.home.carousel.title' | translate }}</h2>

            <div class="carousel-container">
                <button class="carousel-arrow left" (click)="prevSlide()">
                    <mat-icon>chevron_left</mat-icon>
                </button>

                <div class="carousel-wrapper">
                    <div class="carousel" [style.transform]="'translateX(-' + currentIndex * 100 + '%)'">

                        <div class="carousel-item" *ngFor="let p of pastPrepas">
                            <div class="carousel-card">
                                <div class="carousel-name">
                                    <img *ngIf="p.location" class="carousel-flag"
                                        [src]="'assets/images/flag/' + p.location + '.png'" />
                                    {{ p.name }}
                                </div>
                                <div class="carousel-date">
                                    {{ 'i18n.page.home.carousel.date' | translate }}: {{ p.endDate | date:'longDate' }}
                                </div>

                                <div class="carousel-meta">
                                    <ng-container *ngIf="p.type === 'FITNESS'; else running">
                                        <mat-icon>electric_bolt</mat-icon> {{ p.fitnessGoal }}
                                    </ng-container>
                                    <ng-template #running>
                                        <div *ngIf="p.distanceKm">
                                            <mat-icon>straighten</mat-icon> {{ p.distanceKm }} {{
                                            'i18n.page.home.carousel.km' | translate }}
                                        </div>
                                        <div *ngIf="p.elevationGain">
                                            <mat-icon>terrain</mat-icon> {{ p.elevationGain }} {{
                                            'i18n.page.home.carousel.elevation' | translate }}
                                        </div>
                                    </ng-template>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <button class="carousel-arrow right" (click)="nextSlide()">
                    <mat-icon>chevron_right</mat-icon>
                </button>
            </div>

            <!-- petits points sous le carousel -->
            <div class="carousel-dots">
                <div *ngFor="let p of pastPrepas; let i = index" class="dot" [class.active]="i === currentIndex"
                    (click)="goToSlide(i)">
                </div>
            </div>

        </div>
    </ng-template>
</ng-container>